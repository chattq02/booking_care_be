// =========================
// BẢNG CA KHÁM / LỊCH LÀM VIỆC (SCHEDULE)
// =========================

enum ScheduleType {
  DOCTOR
  DEPARTMENT
  FACILITY
}

enum ScheduleStatus {
  NORMAL // Lịch bình thường, bác sĩ khám theo slots
  OFF // Lịch nghỉ
  FIXED // Lịch cố định (định kỳ)
}

model Schedule {
  id           Int            @id @default(autoincrement()) // Khóa chính
  doctorId     Int? // FK: Bác sĩ phụ trách
  facilityId   Int? // FK: Cơ sở y tế
  departmentId Int? // FK: Khoa/phòng
  date         DateTime? // Ngày làm việc cụ thể (null nếu là lịch tuần định kỳ)
  slots        Json     @default("[]")// Mảng các ca giờ [{dayOfWeek, startTime, endTime, price}]
  type         ScheduleType // Loại lịch (doctor, department, facility)
  status       ScheduleStatus @default(NORMAL) // Trạng thái lịch

  // Quan hệ
  doctor       User?            @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  facility     MedicalFacility? @relation(fields: [facilityId], references: [id], onDelete: Cascade, name: "FacilitySchedules")
  department   Department?      @relation(fields: [departmentId], references: [id], onDelete: Cascade, name: "DepartmentSchedules")
  appointments Appointment[] // Danh sách các lịch khám trong ca này

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@index([doctorId, date])
  @@index([facilityId, departmentId])
  @@map("schedules")
}
